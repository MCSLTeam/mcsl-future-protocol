# 操作

**操作（Action）** 是客户端主动发起的请求，服务器在收到请求后将会将结果返回给客户端。

## 任务型操作

部分操作可能执行时间较长，因此支持以任务型操作（Task Action）的形式发起。

任务型操作的处理方式：

- 服务器接收请求后异步执行任务。
- 任务执行过程中，服务器会定期向客户端发送进度更新（格式见下）。
- 任务最终会成功或失败，并返回相应结果或错误信息。

## 请求字段

|   字段   |          数据类型          |                  说明                   |
|:------:|:----------------------:|:-------------------------------------:|
| action |          str           | 操作名称，使用下划线命名法，如 `file_upload_request` |
|  data  |          any           |           操作参数，因操作而异，可能不存在            |
|   id   | [uuid](models.md#uuid) |      操作编号，响应也包含一个 `id` 字段，它们的值相同      |

## 响应字段

### 任务进度

当任务执行过程中需要更新进度时，服务器会发送如下格式的响应：

|     字段     |          数据类型          |                  说明                   |
|:----------:|:----------------------:|:-------------------------------------:|
|     id     | [uuid](models.md#uuid) |         操作编号，与请求中的 `id` 字段相同          |
|    step    |          int8          |            当前任务序号，从 `1` 开始            |
| total_step |          int8          |                 总任务数                  |
|    name    |         string         | 当前任务 ID，可选，用于客户端中显示任务名称，任务 ID 定义因操作而异 |

### 成功

当任务成功完成时，服务器返回如下格式的响应：

|   字段   |          数据类型          |          说明          |
|:------:|:----------------------:|:--------------------:|
|   id   | [uuid](models.md#uuid) | 操作编号，与请求中的 `id` 字段相同 |
| result |          any           |   操作结果，因操作而异，可能不存在   |

### 失败

#### 执行失败

请求已成功解析，但操作执行过程中出错。

|  字段   |          数据类型          |              说明              |
|:-----:|:----------------------:|:----------------------------:|
|  id   | [uuid](models.md#uuid) |     操作编号，与请求中的 `id` 字段相同     |
| error |         uint16         | 错误代码，见 [](action-errcode.md) |

#### 解析失败

无法解析请求内容（如格式错误等）。

|   字段    |  数据类型  |        说明         |
|:-------:|:------:|:-----------------:|
|  error  | uint16 | 错误代码，应始终为 `10001` |
| request |  bin   |       发送的信息       |
